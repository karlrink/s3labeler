<!DOCTYPE html>
<html>

<head>
  <title></title>

  <meta charset="utf-8">

</head>

<body>

<noscript>Please Enable JavaScript</noscript>

<div class="container"></div>


<script>

async function getUrl(url) {
    //let url = 'http://127.0.0.1:8880/s3/';
    try {
        let response = await fetch(url, {mode:'cors',method:'GET'});
        //return await res.json();
        return response;
    } catch (error) {
        console.log(error);
        return error;
    }
}


async function getBuckets() {
    let url = 'http://127.0.0.1:8880/s3/';
    try {
        let res = await fetch(url, {mode:'cors'});
        return await res.json();
    } catch (error) {
        console.log(error);
    }
}

async function renderBuckets_v1() {
    let buckets = await getBuckets();
    let html = '';
    buckets.forEach(bucket => {
        //console.log(bucket)
        //let htmlSegment = `<div class=""> <a href="http://127.0.0.1:8880/s3/${bucket}/">${bucket}</a> </div>`;
        let htmlSegment = `<div class=""> <button onclick="renderBucketFiles('${bucket}')">${bucket}</button> </div>`;

        html += htmlSegment;
    });

    let container = document.querySelector('.container');
    container.innerHTML = html;
}

async function renderBuckets_v2() {

    let url = 'http://127.0.0.1:8880/s3/';

    let html = '';

    try {
        let response = await fetch(url, {mode:'cors'});
        let buckets = await response.json();
        buckets.forEach(bucket => {
        let htmlSegment = `<div class=""> <button onclick="renderBucketFiles('${bucket}')">${bucket}</button> </div>`;
        html += htmlSegment;
    });
    } catch (error) {
        html += error;
    }

    let container = document.querySelector('.container');
    container.innerHTML = html;
}


async function renderBuckets() {

    let container = document.querySelector('.container');

    let url = 'http://127.0.0.1:8880/s3/';

    let html = '';

    try {
        //let response = await fetch(url, {mode:'cors'});
        response = await fetch(url, {mode:'cors'});
    } catch (error) {
        //html += error;
        //container.innerHTML = html;
        container.innerHTML = error;
    }

    //buckets = await response.json();

    try {
        buckets = await response.json();
        buckets.forEach(bucket => {
        let htmlSegment = `<div class=""> <button onclick="renderBucketFiles('${bucket}')">${bucket}</button> </div>`;
        html += htmlSegment;
    });
    } catch (error) {
        //html += error;
        container.innerHTML = error;
    }




    //let response = await getUrl(url);
    //console.log(response);
    //html += response;

    //let json = await response.json();

    //let container = document.querySelector('.container');
    container.innerHTML = html;
}




async function getBucketFiles(bucket) {
    let url = 'http://127.0.0.1:8880/s3/' + bucket + '/';
    try {
        let res = await fetch(url, {mode:'cors'});
        return await res.json();
    } catch (error) {
        console.log(error);
    }
}

async function renderBucketFiles(bucket) {

    let files = await getBucketFiles(bucket);
    let html = '';
    files.forEach(file => {
        let htmlSegment = `<div class=""> 
                             <a href="http://127.0.0.1:8880/s3/${bucket}/${file}">${bucket}/${file}</a>
                           </div>`;

        html += htmlSegment;
    });

    let container = document.querySelector('.container');
    container.innerHTML = html;
}


async function getFileLabels(bucket, file) {

    let url = 'http://127.0.0.1:8880/s3/' + bucket + '/' + file;
    try {
        let res = await fetch(url, {mode:'cors'});
        return await res.json();
    } catch (error) {
        console.log(error);
        //return error
    }
}

async function renderFileLabels(bucket, file) {

    let labels = await getFileLabels(bucket, file);

    //let html = '';
    //let html = '<div>' + bucket +  '/' + file + '</div>';
    let html = bucket +  '/' + file;

    for (const [key, value] of Object.entries(labels)) {
      //console.log(`${key}: ${value}`);
      let htmlSegment = `<div class=""> <p>${key} : ${value}</p> </div>`;
      html += htmlSegment;
    }

    let container = document.querySelector('.container');
    container.innerHTML = html;
}


//function myFunction(value, index, array) {
//  txt += value + "<br>";
//}





//renderBuckets_v1();
renderBuckets();
//renderBucketFiles('bucket_name');
//renderFileLabels('wmn', 'hello.txt');

</script>

</body>

</html>
